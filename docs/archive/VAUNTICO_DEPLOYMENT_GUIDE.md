# Vauntico Backend Deployment Guide

**Date:** January 5, 2026  
**Purpose:** Complete deployment of Vauntico backend services to OCI infrastructure

---

## üéØ **DEPLOYMENT OVERVIEW**

This guide provides a **complete, automated deployment solution** for Vauntico backend services using PowerShell and Oracle Cloud Infrastructure (OCI).

### **Services to Deploy:**

1. **Trust Score Service** - `trust-score.vauntico.com` (Port 3000)
2. **Vauntico Server** - `vauntico-server.vauntico.com` (Port 3001)
3. **Fulfillment Engine** - `fulfillment.vauntico.com` (Port 3002)
4. **Legacy Server** - `legacy.vauntico.com` (Port 3003)

---

## üîß **PREREQUISITES**

### **Required Tools:**

- ‚úÖ **PowerShell 5.1+** - Windows PowerShell (pre-installed)
- ‚úÖ **OCI CLI** - Oracle Cloud Infrastructure CLI
- ‚úÖ **curl** - HTTP client for testing (pre-installed)
- ‚úÖ **plink** - SSH client (PuTTY suite, recommended)

### **Required OCI Credentials:**

```bash
# Replace these values in deploy-vauntico-backend.ps1
$compartmentId = "ocid1.compartment.oc1..aaaaaaaaxxxxx"      # Your compartment OCID
$availabilityDomain = "Uocm:JOHANNESBURG-1-AD-1"              # Your availability domain
$imageId = "ocid1.image.oc1..aaaaaaaayyyyy"                  # Your base image OCID
$subnetId = "ocid1.subnet.oc1..aaaaaaaazzzzz"                  # Your subnet OCID
```

### **Required Permissions:**

- OCI **Compute Instance Management**
- OCI **Network Management**
- OCI **Security List Management**
- SSH access to deployed instances

---

## üöÄ **QUICK START GUIDE**

### **Step 1: Prepare Credentials**

1. **Edit the PowerShell script:**

   ```powershell
   # Open deploy-vauntico-backend.ps1
   # Replace the 4 variables at the top with your actual OCIDs
   $compartmentId = "YOUR_COMPARTMENT_OCID"
   $availabilityDomain = "YOUR_AVAILABILITY_DOMAIN"
   $imageId = "YOUR_IMAGE_OCID"
   $subnetId = "YOUR_SUBNET_OCID"
   ```

2. **Verify OCI CLI access:**
   ```powershell
   oci setup config
   # Follow the interactive prompts with your credentials
   ```

### **Step 2: Execute Deployment**

```powershell
# Run the deployment script
.\deploy-vauntico-backend.ps1
```

### **Step 3: Configure DNS**

After deployment completes, run the generated DNS commands:

```bash
# Example DNS commands (outputs will be generated by script)
cfcli dns add A trust-score vault <PUBLIC_IP_1>
cfcli dns add A vauntico-server vault <PUBLIC_IP_2>
cfcli dns add A fulfillment vault <PUBLIC_IP_3>
cfcli dns add A legacy vault <PUBLIC_IP_4>
```

---

## üìã **DEPLOYMENT PHASES**

### **Phase 1: Infrastructure Provisioning**

- Launches 4 OCI compute instances (VM.Standard.E2.1)
- Assigns public IP addresses to each instance
- Configures networking and security automatically
- Returns instance OCIDs and public IPs

### **Phase 2: Service Deployment**

- Connects to each instance via SSH
- Deploys Docker services using docker-compose
- Starts all Vauntico backend services
- Configures proper port mapping (3000-3003)

### **Phase 3: Health Verification**

- Tests health endpoints on all services
- Validates service startup and accessibility
- Confirms proper port binding
- Generates health status report

### **Phase 4: DNS Configuration**

- Generates DNS A record commands
- Maps subdomains to instance public IPs
- Provides ready-to-execute Cloudflare CLI commands
- Prepares SSL certificate validation

### **Phase 5: Integration Testing**

- Generates comprehensive test commands
- Tests API endpoints and payment processing
- Validates end-to-end functionality
- Provides success criteria

---

## üîç **EXPECTED RESULTS**

### **Successful Deployment Output:**

```
=== VAUNTICO BACKEND DEPLOYMENT SCRIPT ===

Step 1: Configuring OCI CLI...
OCI CLI configuration completed

Step 2: Launching Compute Instances...
Launching vauntico-trust-score-vm...
‚úÖ Instance launched: ocid1.instance.oc1..aaaaaaaaaaaabbbb
   Public IP: 152.70.45.67

‚úÖ Instance launched: ocid1.instance.oc1..aaaaaaaaaaaccc
   Public IP: 152.70.45.68

‚úÖ Instance launched: ocid1.instance.oc1..aaaaaaaaaaaddd
   Public IP: 152.70.45.69

‚úÖ Instance launched: ocid1.instance.oc1..aaaaaaaaaaaeff
   Public IP: 152.70.45.70

Step 3: Deploying Services via SSH...
Deploying trust-score on 152.70.45.67...
‚úÖ trust-score deployed successfully

Deploying vauntico-server on 152.70.45.68...
‚úÖ vauntico-server deployed successfully

Deploying fulfillment on 152.70.45.69...
‚úÖ fulfillment deployed successfully

Deploying legacy on 152.70.45.70...
‚úÖ legacy deployed successfully

Step 4: Verifying Health Endpoints...
Testing trust-score health endpoint...
‚úÖ trust-score health check passed

Testing vauntico-server health endpoint...
‚úÖ vauntico-server health check passed

Testing fulfillment health endpoint...
‚úÖ fulfillment health check passed

Testing legacy health endpoint...
‚úÖ legacy health check passed

Step 5: Generating DNS Configuration...
DNS Record: trust-score.vauntico.com -> 152.70.45.67
DNS Record: vauntico-server.vauntico.com -> 152.70.45.68
DNS Record: fulfillment.vauntico.com -> 152.70.45.69
DNS Record: legacy.vauntico.com -> 152.70.45.70

=== DNS CONFIGURATION COMMANDS ===
cfcli dns add A trust-score vault 152.70.45.67
cfcli dns add A vauntico-server vault 152.70.45.68
cfcli dns add A fulfillment vault 152.70.45.69
cfcli dns add A legacy vault 152.70.45.70

=== INTEGRATION TEST COMMANDS ===
# Test API endpoints
curl -I https://vault.vauntico.com/api/waitlist
curl -I https://trust-score.vauntico.com/health
curl -I https://vauntico-server.vauntico.com/api/waitlist

# Test payment sandbox
curl -X POST https://vauntico-server.vauntico.com/payments/test -H "Content-Type: application/json" -d "{\"amount\":100,\"currency\":\"ZAR\"}"

# Success indicators:
# - All endpoints return 200 OK
# - Payment sandbox responds with JSON confirmation
# - SSL padlock active on all subdomains

=== DEPLOYMENT SUMMARY ===
Services Deployed: 4

Service: trust-score
  Name: vauntico-trust-score-vm
  IP: 152.70.45.67
  Port: 3000

Service: vauntico-server
  Name: vauntico-server-vm
  IP: 152.70.45.68
  Port: 3001

Service: fulfillment
  Name: vauntico-fulfillment-vm
  IP: 152.70.45.69
  Port: 3002

Service: legacy
  Name: vauntico-legacy-vm
  IP: 152.70.45.70
  Port: 3003

=== DEPLOYMENT COMPLETE ===
Next Steps:
1. Run DNS configuration commands above
2. Wait for DNS propagation
3. Execute integration test commands
4. Verify SSL certificate validation
```

---

## üö® **TROUBLESHOOTING**

### **Common Issues and Solutions:**

#### **Issue 1: OCI Authentication Failed**

```
Error: OCI CLI configuration failed
```

**Solution:**

1. Verify OCIDs are correct
2. Check API key permissions
3. Ensure proper OCI region configuration
4. Validate user has compute permissions

#### **Issue 2: Instance Launch Failed**

```
Error: Error launching vauntico-server-vm: AuthorizationFailed
```

**Solution:**

1. Check compartment permissions
2. Verify quota limits
3. Validate image OCID exists
4. Check subnet configuration

#### **Issue 3: SSH Connection Failed**

```
Error: SSH error for trust-score: Exit code 255
```

**Solution:**

1. Verify SSH key is properly configured
2. Check instance is running (oci compute instance list)
3. Wait 2-3 minutes after instance launch
4. Verify security group allows SSH (port 22)

#### **Issue 4: Health Check Failed**

```
Error: trust-score health check failed
   URL: http://152.70.45.67:3000/health
```

**Solution:**

1. Check Docker service status: `ssh opc@IP "docker ps"`
2. Verify port mapping in docker-compose.yml
3. Check service logs: `ssh opc@IP "docker logs trust-score"`
4. Restart service if needed: `ssh opc@IP "docker-compose restart"`

#### **Issue 5: DNS Propagation Delay**

```
Error: DNS resolution failing
```

**Solution:**

1. Wait 5-15 minutes for DNS propagation
2. Use DNS propagation check tools
3. Verify DNS records in provider dashboard
4. Check TTL settings (recommend 300 seconds)

---

## üìä **MONITORING AND VALIDATION**

### **Post-Deployment Health Checks:**

```powershell
# Automated health check script
$services = @("trust-score", "vauntico-server", "fulfillment", "legacy")
$domains = @("trust-score.vauntico.com", "vauntico-server.vauntico.com", "fulfillment.vauntico.com", "legacy.vauntico.com")

foreach ($i in 0..3) {
    $service = $services[$i]
    $domain = $domains[$i]
    $healthResult = curl -I "https://$domain/health" 2>&1
    Write-Host "$service`: $healthResult"
}
```

### **Performance Monitoring:**

```bash
# Monitor response times
for domain in trust-score.vauntico.com vauntico-server.vauntico.com fulfillment.vauntico.com legacy.vauntico.com; do
  echo "Testing $domain..."
  curl -w "@@{http_code},@{time_total},@{size_download}" -o /dev/null -s "https://$domain/health"
  sleep 5
done
```

### **Log Monitoring:**

```bash
# Check service logs on all instances
for ip in 152.70.45.67 152.70.45.68 152.70.45.69 152.70.45.70; do
  echo "=== Logs for $ip ==="
  ssh opc@$ip "docker logs --tail=50" 2>&1
done
```

---

## üõ°Ô∏è **SECURITY CONSIDERATIONS**

### **OCI Security Best Practices:**

1. **Network Security Groups:** Restrict to required ports only
2. **IAM Policies:** Principle of least privilege
3. **SSH Keys:** Use unique keys per environment
4. **Instance Access:** Disable password authentication
5. **Monitoring:** Enable OCI monitoring and logging

### **Application Security:**

1. **Environment Variables:** Store secrets in OCI Vault
2. **API Security:** Rate limiting and CORS configuration
3. **Database Security:** SSL connections and parameterized queries
4. **Container Security:** Non-root user, minimal attack surface

### **SSL/TLS Security:**

1. **Certificate Management:** Automated renewal via Vercel
2. **HSTS Headers:** Strict transport security
3. **Certificate Chains:** Complete certificate chain validation
4. **OCSP Stapling:** Online Certificate Status Protocol

---

## üìû **SUPPORT AND ESCALATION**

### **Immediate Support Contacts:**

- **Infrastructure Team:** For OCI credential and permission issues
- **DevOps Team:** For deployment script and automation issues
- **Security Team:** For security concerns and incident response
- **Application Team:** For service-specific issues

### **Escalation Process:**

1. **Level 1:** Use this guide and troubleshooting section
2. **Level 2:** Contact appropriate support team
3. **Level 3:** Incident response for production issues
4. **Level 4:** Emergency rollback procedures

### **Documentation Links:**

- [OCI Documentation](https://docs.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm)
- [Vauntico Architecture](./docs/ARCHITECTURE.md)
- [Monitoring Guide](./MONITORING_GUIDE.md)
- [Security Policies](./docs/SECURITY_POLICY.md)

---

## üéØ **SUCCESS CRITERIA**

### **Deployment Success Indicators:**

- ‚úÖ **All 4 instances launched** with public IPs
- ‚úÖ **All Docker services running** and healthy
- ‚úÖ **Health endpoints responding** with 200 OK
- ‚úÖ **DNS records configured** for all subdomains
- ‚úÖ **SSL certificates valid** on all domains
- ‚úÖ **API endpoints accessible** via HTTPS
- ‚úÖ **Payment processing functional** in sandbox mode

### **Performance Success Indicators:**

- ‚úÖ **Response times < 200ms** for health endpoints
- ‚úÖ **Uptime > 99.9%** for first 24 hours
- ‚úÖ **Zero security incidents** during deployment
- ‚úÖ **All monitoring alerts** configured and functional

---

## üöÄ **NEXT STEPS AFTER DEPLOYMENT**

### **Phase 1: Validation (First 24 Hours)**

1. Execute integration test commands
2. Verify DNS propagation completion
3. Test end-to-end user workflows
4. Validate payment processing with Paystack
5. Confirm SSL certificate validation

### **Phase 2: Production Cutover (Following 24 Hours)**

1. Update production DNS if using staging subdomains
2. Configure production monitoring and alerting
3. Perform load testing and performance validation
4. Execute security audit and penetration testing
5. Prepare rollback procedures

### **Phase 3: Go-Live (Final 24 Hours)**

1. Final smoke testing of all systems
2. Team training and documentation handover
3. Customer communication and launch announcement
4. Production monitoring activation
5. Success metrics and KPI tracking

---

## üìà **TIME AND COST ESTIMATES**

### **Deployment Time Breakdown:**

- **Credential Setup:** 15 minutes
- **Instance Provisioning:** 10-15 minutes per instance (40-60 total)
- **Service Deployment:** 5-10 minutes per instance (20-40 total)
- **Health Verification:** 5-10 minutes total
- **DNS Configuration:** 5-10 minutes
- **Integration Testing:** 15-30 minutes

**Total Estimated Time:** 1.5-2.5 hours

### **OCI Cost Estimates (Monthly):**

- **VM.Standard.E2.1:** ~$25-35 per instance √ó 4 = $100-140
- **Data Transfer:** ~$10-20 per month
- **Load Balancer:** ~$20-30 per month (if used)
- **Monitoring:** ~$5-10 per month

**Estimated Total Monthly Cost:** $135-200

---

**Guide Created:** January 5, 2026  
**Last Updated:** January 5, 2026  
**Version:** 1.0  
**Status:** ‚úÖ **READY FOR EXECUTION**
